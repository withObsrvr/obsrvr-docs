"use strict";(self.webpackChunkobsrvr_docs=self.webpackChunkobsrvr_docs||[]).push([[6774],{6912:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"flow/consumers/postgresql","title":"PostgreSQL","description":"The PostgreSQL consumer delivers processed blockchain data to PostgreSQL databases, offering flexible schema options and enterprise-grade reliability for data storage and analytics.","source":"@site/docs/flow/consumers/postgresql.md","sourceDirName":"flow/consumers","slug":"/flow/consumers/postgresql","permalink":"/docs/flow/consumers/postgresql","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"PostgreSQL"},"sidebar":"docs","previous":{"title":"Consumers Overview","permalink":"/docs/flow/consumers/"},"next":{"title":"Pricing","permalink":"/docs/flow/pricing"}}');var r=s(4848),t=s(8453);const a={sidebar_position:2,title:"PostgreSQL"},o="PostgreSQL Consumer",c={},l=[{value:"Overview",id:"overview",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Basic PostgreSQL Consumer",id:"basic-postgresql-consumer",level:3},{value:"Parameters",id:"parameters",level:4},{value:"Example Configuration",id:"example-configuration",level:4},{value:"Connection String Format",id:"connection-string-format",level:3},{value:"Specialized PostgreSQL Consumers",id:"specialized-postgresql-consumers",level:2},{value:"Account Data PostgreSQL",id:"account-data-postgresql",level:3},{value:"Contract Events PostgreSQL",id:"contract-events-postgresql",level:3},{value:"Contract Data PostgreSQL",id:"contract-data-postgresql",level:3},{value:"Schema Design",id:"schema-design",level:2},{value:"Generic Schema (Default)",id:"generic-schema-default",level:3},{value:"Custom Schema Configuration",id:"custom-schema-configuration",level:3},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"Batch Size Tuning",id:"batch-size-tuning",level:3},{value:"Connection Pool Configuration",id:"connection-pool-configuration",level:3},{value:"Indexing Strategy",id:"indexing-strategy",level:3},{value:"Use Cases",id:"use-cases",level:2},{value:"Analytics Database",id:"analytics-database",level:3},{value:"Real-time Application Backend",id:"real-time-application-backend",level:3},{value:"Historical Data Warehouse",id:"historical-data-warehouse",level:3},{value:"Monitoring &amp; Maintenance",id:"monitoring--maintenance",level:2},{value:"Query Performance",id:"query-performance",level:3},{value:"Table Maintenance",id:"table-maintenance",level:3},{value:"Connection Monitoring",id:"connection-monitoring",level:3},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"Example User Setup",id:"example-user-setup",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Connection Issues",id:"connection-issues",level:3},{value:"Performance Issues",id:"performance-issues",level:3},{value:"Related Consumers",id:"related-consumers",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"postgresql-consumer",children:"PostgreSQL Consumer"})}),"\n",(0,r.jsx)(n.p,{children:"The PostgreSQL consumer delivers processed blockchain data to PostgreSQL databases, offering flexible schema options and enterprise-grade reliability for data storage and analytics."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"PostgreSQL is the most versatile consumer in Flow, supporting:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Generic schemas"})," for flexible data storage"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Specialized schemas"})," optimized for specific data types"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Custom schemas"})," for your specific requirements"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Batch processing"})," for optimal performance"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Connection pooling"})," for scalability"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"basic-postgresql-consumer",children:"Basic PostgreSQL Consumer"}),"\n",(0,r.jsx)(n.p,{children:"The standard PostgreSQL consumer stores data in a flexible JSON format."}),"\n",(0,r.jsx)(n.h4,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter"}),(0,r.jsx)(n.th,{children:"Type"}),(0,r.jsx)(n.th,{children:"Required"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"connection_string"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"Yes"}),(0,r.jsx)(n.td,{children:"-"}),(0,r.jsx)(n.td,{children:"PostgreSQL connection string"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"batch_size"})}),(0,r.jsx)(n.td,{children:"integer"}),(0,r.jsx)(n.td,{children:"No"}),(0,r.jsx)(n.td,{children:"5"}),(0,r.jsx)(n.td,{children:"Records per batch (1-100)"})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"example-configuration",children:"Example Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "type": "postgres",\n  "config": {\n    "connection_string": "postgresql://user:password@host:5432/database?sslmode=require",\n    "batch_size": 50\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"connection-string-format",children:"Connection String Format"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"postgresql://[user[:password]@][host][:port][/dbname][?param1=value1&...]\n"})}),"\n",(0,r.jsx)(n.p,{children:"Common parameters:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sslmode"}),": ",(0,r.jsx)(n.code,{children:"disable"}),", ",(0,r.jsx)(n.code,{children:"require"}),", ",(0,r.jsx)(n.code,{children:"verify-ca"}),", ",(0,r.jsx)(n.code,{children:"verify-full"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"connect_timeout"}),": Connection timeout in seconds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"application_name"}),": Identify your application in pg_stat_activity"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"specialized-postgresql-consumers",children:"Specialized PostgreSQL Consumers"}),"\n",(0,r.jsx)(n.p,{children:"Flow provides optimized consumers for specific data types:"}),"\n",(0,r.jsx)(n.h3,{id:"account-data-postgresql",children:"Account Data PostgreSQL"}),"\n",(0,r.jsx)(n.p,{children:"Stores Stellar account information with optimized schema."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "type": "account_data_postgres",\n  "config": {\n    "host": "localhost",\n    "port": 5432,\n    "database": "stellar_accounts",\n    "username": "user",\n    "password": "password",\n    "sslmode": "require",\n    "max_open_conns": 20,\n    "max_idle_conns": 10\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"contract-events-postgresql",children:"Contract Events PostgreSQL"}),"\n",(0,r.jsx)(n.p,{children:"Optimized for Soroban contract events with indexed topics."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "type": "contract_events_postgres",\n  "config": {\n    "host": "localhost",\n    "port": 5432,\n    "database": "contract_events",\n    "username": "user",\n    "password": "password"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"contract-data-postgresql",children:"Contract Data PostgreSQL"}),"\n",(0,r.jsx)(n.p,{children:"Supports custom schemas for contract data storage."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "type": "contract_data_postgres",\n  "config": {\n    "database_url": "postgresql://user:password@host/db",\n    "table_name": "contract_storage",\n    "create_table_if_not_exists": true,\n    "batch_size": 100,\n    "schema_config": {\n      "columns": [\n        {"name": "contract_id", "type": "text"},\n        {"name": "key", "type": "text"},\n        {"name": "value", "type": "jsonb"},\n        {"name": "ledger", "type": "bigint"}\n      ]\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"schema-design",children:"Schema Design"}),"\n",(0,r.jsx)(n.h3,{id:"generic-schema-default",children:"Generic Schema (Default)"}),"\n",(0,r.jsx)(n.p,{children:"The basic PostgreSQL consumer uses a flexible schema:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE flow_data (\n    id SERIAL PRIMARY KEY,\n    ledger BIGINT NOT NULL,\n    timestamp TIMESTAMP WITH TIME ZONE,\n    data JSONB NOT NULL,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n);\n\nCREATE INDEX idx_flow_data_ledger ON flow_data(ledger);\nCREATE INDEX idx_flow_data_timestamp ON flow_data(timestamp);\nCREATE INDEX idx_flow_data_jsonb ON flow_data USING GIN(data);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"custom-schema-configuration",children:"Custom Schema Configuration"}),"\n",(0,r.jsx)(n.p,{children:"For specialized consumers that support schema configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "schema_config": {\n    "columns": [\n      {\n        "name": "transaction_hash",\n        "type": "text",\n        "nullable": false,\n        "primary_key": true\n      },\n      {\n        "name": "amount",\n        "type": "numeric",\n        "nullable": false\n      },\n      {\n        "name": "memo",\n        "type": "text",\n        "nullable": true\n      },\n      {\n        "name": "created_at",\n        "type": "timestamp",\n        "default": "NOW()"\n      }\n    ],\n    "indexes": [\n      {\n        "columns": ["created_at"],\n        "type": "btree"\n      },\n      {\n        "columns": ["memo"],\n        "type": "hash",\n        "where": "memo IS NOT NULL"\n      }\n    ]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,r.jsx)(n.h3,{id:"batch-size-tuning",children:"Batch Size Tuning"}),"\n",(0,r.jsx)(n.p,{children:"Choose batch size based on your use case:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Small batches (1-10)"}),": Lower latency, real-time updates"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Medium batches (10-50)"}),": Balanced performance"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Large batches (50-100)"}),": Maximum throughput"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"connection-pool-configuration",children:"Connection Pool Configuration"}),"\n",(0,r.jsx)(n.p,{children:"For specialized consumers:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "max_open_conns": 25,    // Maximum open connections\n  "max_idle_conns": 5,     // Maximum idle connections\n  "conn_max_lifetime": 300  // Connection lifetime in seconds\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"indexing-strategy",children:"Indexing Strategy"}),"\n",(0,r.jsx)(n.p,{children:"Create appropriate indexes for your queries:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- For time-series queries\nCREATE INDEX idx_timestamp ON your_table(timestamp DESC);\n\n-- For filtering by specific fields\nCREATE INDEX idx_account ON your_table(account_id);\n\n-- For JSONB queries\nCREATE INDEX idx_data_gin ON your_table USING GIN(data);\n\n-- For complex queries\nCREATE INDEX idx_composite ON your_table(account_id, timestamp DESC);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,r.jsx)(n.h3,{id:"analytics-database",children:"Analytics Database"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "processor": {\n    "type": "raw_transactions"\n  },\n  "consumer": {\n    "type": "postgres",\n    "config": {\n      "connection_string": "postgresql://analytics:pass@analytics.db/stellar",\n      "batch_size": 100\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"real-time-application-backend",children:"Real-time Application Backend"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "processor": {\n    "type": "payments_memo",\n    "config": {\n      "memo_text": "app-payment"\n    }\n  },\n  "consumer": {\n    "type": "postgres",\n    "config": {\n      "connection_string": "postgresql://app:pass@app.db/payments",\n      "batch_size": 1\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"historical-data-warehouse",children:"Historical Data Warehouse"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "processor": {\n    "type": "account_balance",\n    "config": {\n      "account_ids": ["GXXXX...", "GYYYY..."]\n    }\n  },\n  "consumer": {\n    "type": "postgres",\n    "config": {\n      "connection_string": "postgresql://warehouse:pass@warehouse.db/balances",\n      "batch_size": 50\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"monitoring--maintenance",children:"Monitoring & Maintenance"}),"\n",(0,r.jsx)(n.h3,{id:"query-performance",children:"Query Performance"}),"\n",(0,r.jsx)(n.p,{children:"Monitor slow queries:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT query, calls, total_time, mean_time\nFROM pg_stat_statements\nWHERE mean_time > 100\nORDER BY mean_time DESC;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"table-maintenance",children:"Table Maintenance"}),"\n",(0,r.jsx)(n.p,{children:"Regular maintenance tasks:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Analyze tables for query optimization\nANALYZE your_table;\n\n-- Vacuum to reclaim space\nVACUUM ANALYZE your_table;\n\n-- Reindex for performance\nREINDEX TABLE your_table;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"connection-monitoring",children:"Connection Monitoring"}),"\n",(0,r.jsx)(n.p,{children:"Check active connections:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"SELECT pid, usename, application_name, state, query_start\nFROM pg_stat_activity\nWHERE datname = 'your_database';\n"})}),"\n",(0,r.jsx)(n.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use SSL/TLS"}),": Always set ",(0,r.jsx)(n.code,{children:"sslmode=require"})," or stronger"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Credential Rotation"}),": Regularly rotate database passwords"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Least Privilege"}),": Create specific users with minimal permissions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Network Security"}),": Use VPC/private networks when possible"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Audit Logging"}),": Enable PostgreSQL audit logging"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"example-user-setup",children:"Example User Setup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"-- Create a dedicated Flow user\nCREATE USER flow_user WITH PASSWORD 'secure_password';\n\n-- Grant minimal permissions\nGRANT CONNECT ON DATABASE stellar_data TO flow_user;\nGRANT USAGE ON SCHEMA public TO flow_user;\nGRANT CREATE ON SCHEMA public TO flow_user;\nGRANT INSERT, SELECT ON ALL TABLES IN SCHEMA public TO flow_user;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"connection-issues",children:"Connection Issues"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Error: Connection refused"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Verify host and port"}),"\n",(0,r.jsx)(n.li,{children:"Check PostgreSQL is running"}),"\n",(0,r.jsx)(n.li,{children:"Verify firewall rules"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Error: Authentication failed"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Check username/password"}),"\n",(0,r.jsx)(n.li,{children:"Verify pg_hba.conf settings"}),"\n",(0,r.jsx)(n.li,{children:"Ensure user has CONNECT permission"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"performance-issues",children:"Performance Issues"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Slow inserts"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Increase batch_size"}),"\n",(0,r.jsx)(n.li,{children:"Check for lock contention"}),"\n",(0,r.jsx)(n.li,{children:"Review indexes (too many can slow inserts)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"High memory usage"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Reduce batch_size"}),"\n",(0,r.jsx)(n.li,{children:"Check for memory leaks"}),"\n",(0,r.jsx)(n.li,{children:"Monitor connection pool size"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"related-consumers",children:"Related Consumers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Redis - For real-time caching"}),"\n",(0,r.jsx)(n.li,{children:"S3 - For data archival"}),"\n",(0,r.jsx)(n.li,{children:"Kafka - For stream processing"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var i=s(6540);const r={},t=i.createContext(r);function a(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);