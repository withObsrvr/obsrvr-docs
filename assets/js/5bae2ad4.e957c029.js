"use strict";(self.webpackChunkobsrvr_docs=self.webpackChunkobsrvr_docs||[]).push([[1247],{7625:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"gateway/guides/stellar-rpc-full-history","title":"Stellar RPC with Full History (Testnet)","description":"Run Stellar RPC on testnet with external datastore for complete historical ledger access","source":"@site/docs/gateway/guides/stellar-rpc-full-history.md","sourceDirName":"gateway/guides","slug":"/gateway/guides/stellar-rpc-full-history","permalink":"/docs/gateway/guides/stellar-rpc-full-history","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Stellar RPC with Full History (Testnet)","description":"Run Stellar RPC on testnet with external datastore for complete historical ledger access"},"sidebar":"docs","previous":{"title":"Gateway Overview","permalink":"/docs/gateway/overview"},"next":{"title":"Overview","permalink":"/docs/flow/overview"}}');var r=t(4848),l=t(8453);const i={sidebar_position:1,title:"Stellar RPC with Full History (Testnet)",description:"Run Stellar RPC on testnet with external datastore for complete historical ledger access"},o="Running Stellar RPC with Full History Access on Testnet",a={},c=[{value:"Overview",id:"overview",level:2},{value:"Available Datastores",id:"available-datastores",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Install Google Cloud SDK",id:"step-1-install-google-cloud-sdk",level:2},{value:"macOS",id:"macos",level:3},{value:"Ubuntu/Debian",id:"ubuntudebian",level:3},{value:"Other Systems",id:"other-systems",level:3},{value:"Step 2: Configure Authentication",id:"step-2-configure-authentication",level:2},{value:"Option A: Application Default Credentials (Development)",id:"option-a-application-default-credentials-development",level:3},{value:"Option B: Service Account (Production)",id:"option-b-service-account-production",level:3},{value:"Step 3: Create Configuration Files",id:"step-3-create-configuration-files",level:2},{value:"Stellar RPC Configuration",id:"stellar-rpc-configuration",level:3},{value:"Stellar Core Configuration",id:"stellar-core-configuration",level:3},{value:"Step 4: Deploy with Docker",id:"step-4-deploy-with-docker",level:2},{value:"With Application Default Credentials",id:"with-application-default-credentials",level:3},{value:"With Service Account Key",id:"with-service-account-key",level:3},{value:"Step 5: Verify Your Setup",id:"step-5-verify-your-setup",level:2},{value:"Check Container Logs",id:"check-container-logs",level:3},{value:"Test RPC Endpoint",id:"test-rpc-endpoint",level:3},{value:"Test RPC Methods",id:"test-rpc-methods",level:3},{value:"1. Get Latest Ledger",id:"1-get-latest-ledger",level:4},{value:"2. Query Historical Ledgers",id:"2-query-historical-ledgers",level:4},{value:"3. Test Recent Ledgers",id:"3-test-recent-ledgers",level:4},{value:"4. Pagination Test",id:"4-pagination-test",level:4},{value:"5. Get Transactions from Historical Ledger",id:"5-get-transactions-from-historical-ledger",level:4},{value:"6. Test Very Early Ledger",id:"6-test-very-early-ledger",level:4},{value:"Monitor Datastore Access",id:"monitor-datastore-access",level:3},{value:"Performance Testing",id:"performance-testing",level:3},{value:"Verify Full History Access",id:"verify-full-history-access",level:3},{value:"Performance Tuning",id:"performance-tuning",level:2},{value:"Optimize Datastore Access",id:"optimize-datastore-access",level:3},{value:"Resource Allocation",id:"resource-allocation",level:3},{value:"Understanding Requester Pays",id:"understanding-requester-pays",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Authentication Errors",id:"authentication-errors",level:3},{value:"Performance Issues",id:"performance-issues",level:3},{value:"Storage Issues",id:"storage-issues",level:3},{value:"Production Considerations",id:"production-considerations",level:2},{value:"Security",id:"security",level:3},{value:"Monitoring",id:"monitoring",level:3},{value:"Backup Strategy",id:"backup-strategy",level:3},{value:"Alternative Datastores",id:"alternative-datastores",level:2},{value:"Google Cloud Storage (GCS)",id:"google-cloud-storage-gcs",level:3},{value:"AWS S3",id:"aws-s3",level:3},{value:"Next Steps",id:"next-steps",level:2},{value:"Need Help?",id:"need-help",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"running-stellar-rpc-with-full-history-access-on-testnet",children:"Running Stellar RPC with Full History Access on Testnet"})}),"\n",(0,r.jsx)(n.p,{children:"This guide explains how to deploy a Stellar RPC node on testnet with access to complete historical ledger data using Google Cloud Storage as an external datastore. This setup allows you to query any point in Stellar's testnet history without storing the entire ledger locally."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Stellar RPC nodes typically store only recent ledger data due to storage constraints. By integrating with an external datastore (like Google Cloud Storage), you can:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Access the complete history of the Stellar testnet"}),"\n",(0,r.jsx)(n.li,{children:"Minimize local storage requirements"}),"\n",(0,r.jsx)(n.li,{children:"Query historical transactions and ledger states"}),"\n",(0,r.jsx)(n.li,{children:"Scale your infrastructure efficiently"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"available-datastores",children:"Available Datastores"}),"\n",(0,r.jsx)(n.p,{children:"Obsrvr provides public access to testnet ledger data through Google Cloud Storage:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Bucket"}),": ",(0,r.jsx)(n.code,{children:"obsrvr-stellar-ledger-data-testnet-data"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Path"}),": ",(0,r.jsx)(n.code,{children:"landing/ledgers/testnet"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Billing"}),": Requester pays (you'll need your own GCP billing account)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(n.p,{children:"Before starting, ensure you have:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Docker installed and running"}),"\n",(0,r.jsx)(n.li,{children:"Google Cloud SDK installed (for authentication)"}),"\n",(0,r.jsx)(n.li,{children:"A Google Cloud account with billing enabled (for requester pays)"}),"\n",(0,r.jsx)(n.li,{children:"Basic familiarity with command line operations"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-1-install-google-cloud-sdk",children:"Step 1: Install Google Cloud SDK"}),"\n",(0,r.jsx)(n.p,{children:"Install the Google Cloud SDK to handle authentication:"}),"\n",(0,r.jsx)(n.h3,{id:"macos",children:"macOS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"brew install google-cloud-sdk\n"})}),"\n",(0,r.jsx)(n.h3,{id:"ubuntudebian",children:"Ubuntu/Debian"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list\ncurl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -\nsudo apt-get update && sudo apt-get install google-cloud-sdk\n'})}),"\n",(0,r.jsx)(n.h3,{id:"other-systems",children:"Other Systems"}),"\n",(0,r.jsxs)(n.p,{children:["Visit the ",(0,r.jsx)(n.a,{href:"https://cloud.google.com/sdk/docs/install",children:"official Google Cloud SDK documentation"})," for installation instructions."]}),"\n",(0,r.jsx)(n.h2,{id:"step-2-configure-authentication",children:"Step 2: Configure Authentication"}),"\n",(0,r.jsx)(n.p,{children:'Since the Obsrvr public bucket uses "requester pays", you must authenticate with Google Cloud:'}),"\n",(0,r.jsx)(n.h3,{id:"option-a-application-default-credentials-development",children:"Option A: Application Default Credentials (Development)"}),"\n",(0,r.jsx)(n.p,{children:"Best for local development and testing:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"gcloud auth application-default login\n"})}),"\n",(0,r.jsx)(n.p,{children:"This opens a browser for authentication and stores credentials locally."}),"\n",(0,r.jsx)(n.h3,{id:"option-b-service-account-production",children:"Option B: Service Account (Production)"}),"\n",(0,r.jsx)(n.p,{children:"Recommended for production deployments:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Create a service account in Google Cloud Console"}),"\n",(0,r.jsx)(n.li,{children:"Download the JSON key file"}),"\n",(0,r.jsx)(n.li,{children:"Ensure the service account has billing enabled"}),"\n",(0,r.jsx)(n.li,{children:"Use the key file in your Docker deployment (see Step 4)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note"}),": The requester pays model means your Google Cloud account will be billed for data egress charges when accessing the bucket."]}),"\n",(0,r.jsx)(n.h2,{id:"step-3-create-configuration-files",children:"Step 3: Create Configuration Files"}),"\n",(0,r.jsx)(n.h3,{id:"stellar-rpc-configuration",children:"Stellar RPC Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"stellar-rpc-datastore.toml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'# Stellar RPC configuration with external datastore\n# For stellar/stellar-rpc:23.0.0\n\n# Basic configuration\nENDPOINT = "0.0.0.0:8000"\nADMIN_ENDPOINT = "0.0.0.0:8001"\nNETWORK_PASSPHRASE = "Test SDF Network ; September 2015"\nHISTORY_ARCHIVE_URLS = ["https://history.stellar.org/prd/core-testnet/core_testnet_001"]\nSTELLAR_CORE_BINARY_PATH = "/usr/bin/stellar-core"\nCAPTIVE_CORE_CONFIG_PATH = "/config/stellar-core.cfg"\nCAPTIVE_CORE_STORAGE_PATH = "/data/captive-core"\nDB_PATH = "/data/stellar_rpc.sqlite"\n\n# Logging\nLOG_LEVEL = "info"\nLOG_FORMAT = "text"\n\n# Set retention to minimum value (1 ledger) to minimize local storage\n# The datastore will handle historical queries beyond this\nHISTORY_RETENTION_WINDOW = 1\n\n# Fee stats windows must be <= history retention window\nSOROBAN_FEE_STATS_RETENTION_WINDOW = 1\nCLASSIC_FEE_STATS_RETENTION_WINDOW = 1\n\n# Enable external datastore for historical ledgers\nSERVE_LEDGERS_FROM_DATASTORE = true\n\n# Datastore configuration\n[datastore_config]\ntype = "GCS"\n\n[datastore_config.params]\n# Obsrvr testnet ledger data bucket\ndestination_bucket_path = "obsrvr-stellar-ledger-data-testnet-data/landing/ledgers/testnet"\n\n[datastore_config.schema]\nledgers_per_file = 1\nfiles_per_partition = 64000\n\n# Buffered storage backend configuration\n[buffered_storage_backend_config]\nbuffer_size = 100\nnum_workers = 10\nretry_limit = 3\nretry_wait = "5s"\n\n\n'})}),"\n",(0,r.jsx)(n.h3,{id:"stellar-core-configuration",children:"Stellar Core Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"stellar-core.cfg"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'# Stellar Core configuration for testnet\nNETWORK_PASSPHRASE="Test SDF Network ; September 2015"\n\nDATABASE="sqlite3:///data/stellar.db"\n\nUNSAFE_QUORUM=true\nFAILURE_SAFETY=0\n\n[[HOME_DOMAINS]]\nHOME_DOMAIN="testnet.stellar.org"\nQUALITY="HIGH"\n\n[[VALIDATORS]]\nNAME="sdf_testnet_1"\nHOME_DOMAIN="testnet.stellar.org"\nPUBLIC_KEY="GDKXE2OZMJIPOSLNA6N6F2BVCI3O777I2OOC4BV7VOYUEHYX7RTRYA7Y"\nADDRESS="core-testnet1.stellar.org"\nHISTORY="curl -sf https://history.stellar.org/prd/core-testnet/core_testnet_001/{0} -o {1}"\n\n[[VALIDATORS]]\nNAME="sdf_testnet_2"\nHOME_DOMAIN="testnet.stellar.org"\nPUBLIC_KEY="GCUCJTIYXSOXKBSNFGNFWW5MUQ54HKRPGJUTQFJ5RQXZXNOLNXYDHRAP"\nADDRESS="core-testnet2.stellar.org"\nHISTORY="curl -sf https://history.stellar.org/prd/core-testnet/core_testnet_002/{0} -o {1}"\n\n[[VALIDATORS]]\nNAME="sdf_testnet_3"\nHOME_DOMAIN="testnet.stellar.org"\nPUBLIC_KEY="GC2V2EFSXN6SQTWVYA5EPJPBWWIMSD2XQNKUOHGEKB535AQE2I6IXV2Z"\nADDRESS="core-testnet3.stellar.org"\nHISTORY="curl -sf https://history.stellar.org/prd/core-testnet/core_testnet_003/{0} -o {1}"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"step-4-deploy-with-docker",children:"Step 4: Deploy with Docker"}),"\n",(0,r.jsx)(n.h3,{id:"with-application-default-credentials",children:"With Application Default Credentials"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run -d \\\n  --name stellar-rpc \\\n  -p 8000:8000 \\\n  -v ~/.config/gcloud:/root/.config/gcloud:ro \\\n  -v $(pwd)/stellar-rpc-datastore.toml:/config/stellar-rpc.toml \\\n  -v $(pwd)/stellar-core.cfg:/config/stellar-core.cfg \\\n  -v stellar-rpc-data:/ledgers \\\n  -e GOOGLE_APPLICATION_CREDENTIALS=/root/.config/gcloud/application_default_credentials.json \\\n  stellar/stellar-rpc:latest \\\n  --config-path /config/stellar-rpc.toml\n"})}),"\n",(0,r.jsx)(n.h3,{id:"with-service-account-key",children:"With Service Account Key"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run -d \\\n  --name stellar-rpc \\\n  -p 8000:8000 \\\n  -v $(pwd)/service-account-key.json:/config/gcp-key.json:ro \\\n  -v $(pwd)/stellar-rpc-datastore.toml:/config/stellar-rpc.toml \\\n  -v $(pwd)/stellar-core.cfg:/config/stellar-core.cfg \\\n  -v stellar-rpc-data:/ledgers \\\n  -e GOOGLE_APPLICATION_CREDENTIALS=/config/gcp-key.json \\\n  stellar/stellar-rpc:latest \\\n  --config-path /config/stellar-rpc.toml\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-5-verify-your-setup",children:"Step 5: Verify Your Setup"}),"\n",(0,r.jsx)(n.h3,{id:"check-container-logs",children:"Check Container Logs"}),"\n",(0,r.jsx)(n.p,{children:"Monitor the startup process:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker logs -f stellar-rpc\n"})}),"\n",(0,r.jsx)(n.p,{children:"Look for messages indicating successful datastore connection and ledger retrieval."}),"\n",(0,r.jsx)(n.h3,{id:"test-rpc-endpoint",children:"Test RPC Endpoint"}),"\n",(0,r.jsx)(n.p,{children:"Once running, test the health endpoint:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:8000/health\n"})}),"\n",(0,r.jsx)(n.h3,{id:"test-rpc-methods",children:"Test RPC Methods"}),"\n",(0,r.jsx)(n.h4,{id:"1-get-latest-ledger",children:"1. Get Latest Ledger"}),"\n",(0,r.jsx)(n.p,{children:"Verify the RPC is syncing with the network:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8000 \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "method": "getLatestLedger",\n    "id": 1\n  }\'\n'})}),"\n",(0,r.jsx)(n.p,{children:"Expected response:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "id": "1",\n  "jsonrpc": "2.0",\n  "result": {\n    "id": "...",\n    "protocolVersion": 21,\n    "sequence": 502464\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"2-query-historical-ledgers",children:"2. Query Historical Ledgers"}),"\n",(0,r.jsx)(n.p,{children:"Test retrieval of historical ledgers from the datastore:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Get a very old ledger (ledger 10000)\ncurl -X POST http://localhost:8000 \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "method": "getLedgers",\n    "params": {\n      "startLedger": 10000,\n      "pagination": {\n        "limit": 1\n      }\n    },\n    "id": 1\n  }\' | jq\n'})}),"\n",(0,r.jsx)(n.h4,{id:"3-test-recent-ledgers",children:"3. Test Recent Ledgers"}),"\n",(0,r.jsx)(n.p,{children:"Verify recent ledgers are accessible:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Get a recent ledger\ncurl -X POST http://localhost:8000 \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "method": "getLedgers",\n    "params": {\n      "startLedger": 500000,\n      "pagination": {\n        "limit": 1\n      }\n    },\n    "id": 1\n  }\' | jq\n'})}),"\n",(0,r.jsx)(n.h4,{id:"4-pagination-test",children:"4. Pagination Test"}),"\n",(0,r.jsx)(n.p,{children:"Test pagination through multiple ledgers:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Get 5 ledgers starting from ledger 10000\ncurl -X POST http://localhost:8000 \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "method": "getLedgers",\n    "params": {\n      "startLedger": 10000,\n      "pagination": {\n        "limit": 5\n      }\n    },\n    "id": 1\n  }\' | jq \'.result.ledgers[].sequence\'\n'})}),"\n",(0,r.jsx)(n.h4,{id:"5-get-transactions-from-historical-ledger",children:"5. Get Transactions from Historical Ledger"}),"\n",(0,r.jsx)(n.p,{children:"Retrieve transactions from a specific historical ledger:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Get transactions from ledger 50000\ncurl -X POST http://localhost:8000 \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "method": "getTransactions",\n    "params": {\n      "startLedger": 50000,\n      "pagination": {\n        "limit": 10\n      }\n    },\n    "id": 1\n  }\' | jq\n'})}),"\n",(0,r.jsx)(n.h4,{id:"6-test-very-early-ledger",children:"6. Test Very Early Ledger"}),"\n",(0,r.jsx)(n.p,{children:"Verify access to genesis or early ledgers:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Get one of the first ledgers\ncurl -X POST http://localhost:8000 \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "method": "getLedgers",\n    "params": {\n      "startLedger": 2,\n      "pagination": {\n        "limit": 1\n      }\n    },\n    "id": 1\n  }\' | jq\n'})}),"\n",(0,r.jsx)(n.h3,{id:"monitor-datastore-access",children:"Monitor Datastore Access"}),"\n",(0,r.jsx)(n.p,{children:"Check logs for datastore-related messages:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# View datastore operations\ndocker logs stellar-rpc 2>&1 | grep -i datastore\n\n# Check for successful ledger retrievals\ndocker logs stellar-rpc 2>&1 | grep -i "fetched ledger"\n\n# Monitor any datastore errors\ndocker logs stellar-rpc 2>&1 | grep -i "error.*datastore"\n'})}),"\n",(0,r.jsx)(n.p,{children:"You should see messages like:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'"Successfully connected to datastore"'}),"\n",(0,r.jsx)(n.li,{children:'"Fetched ledger X from datastore"'}),"\n",(0,r.jsx)(n.li,{children:'"Datastore buffer size: Y"'}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"performance-testing",children:"Performance Testing"}),"\n",(0,r.jsx)(n.p,{children:"Test the response time for different ledger ranges:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Time a historical query\ntime curl -X POST http://localhost:8000 \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n    "jsonrpc": "2.0",\n    "method": "getLedgers",\n    "params": {\n      "startLedger": 100000,\n      "pagination": {\n        "limit": 1\n      }\n    },\n    "id": 1\n  }\' > /dev/null\n'})}),"\n",(0,r.jsx)(n.h3,{id:"verify-full-history-access",children:"Verify Full History Access"}),"\n",(0,r.jsx)(n.p,{children:"Run this script to test access across different ledger ranges:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# test-history.sh\n\necho "Testing Stellar RPC historical data access..."\n\n# Array of test ledgers spanning testnet history\ntest_ledgers=(100 1000 10000 50000 100000 200000 300000 400000 500000)\n\nfor ledger in "${test_ledgers[@]}"; do\n    echo -n "Testing ledger $ledger: "\n    \n    response=$(curl -s -X POST http://localhost:8000 \\\n      -H \'Content-Type: application/json\' \\\n      -d "{\n        \\"jsonrpc\\": \\"2.0\\",\n        \\"method\\": \\"getLedgers\\",\n        \\"params\\": {\n          \\"startLedger\\": $ledger,\n          \\"pagination\\": {\n            \\"limit\\": 1\n          }\n        },\n        \\"id\\": 1\n      }")\n    \n    if echo "$response" | jq -e \'.result.ledgers[0]\' > /dev/null 2>&1; then\n        echo "\u2713 Success"\n    else\n        echo "\u2717 Failed"\n        echo "$response" | jq\n    fi\ndone\n'})}),"\n",(0,r.jsx)(n.p,{children:"Make the script executable and run it:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"chmod +x test-history.sh\n./test-history.sh\n"})}),"\n",(0,r.jsx)(n.h2,{id:"performance-tuning",children:"Performance Tuning"}),"\n",(0,r.jsx)(n.h3,{id:"optimize-datastore-access",children:"Optimize Datastore Access"}),"\n",(0,r.jsx)(n.p,{children:"Adjust these parameters in your configuration based on your needs:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DATASTORE_WORKERS"}),": Number of parallel workers (default: 16)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"DATASTORE_LEDGER_BUFFER_SIZE"}),": Ledger prefetch buffer (default: 5)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"INGESTION_BUFFER_SIZE"}),": Ingestion pipeline buffer (default: 128)"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"resource-allocation",children:"Resource Allocation"}),"\n",(0,r.jsx)(n.p,{children:"For production deployments, ensure adequate resources:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'docker run -d \\\n  --name stellar-rpc \\\n  --memory="8g" \\\n  --cpus="4" \\\n  -p 8000:8000 \\\n  # ... other parameters\n'})}),"\n",(0,r.jsx)(n.h2,{id:"understanding-requester-pays",children:"Understanding Requester Pays"}),"\n",(0,r.jsx)(n.p,{children:'The Obsrvr public bucket uses Google Cloud\'s "requester pays" model:'}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"You pay for data egress"}),": Charges apply when downloading ledger data"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Typical costs"}),": ~$0.12 per GB for most regions"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Billing requirement"}),": Your GCP account must have billing enabled"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Usage tracking"}),": Monitor costs in your GCP billing dashboard"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"To estimate costs:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Initial sync: May download several GB depending on the ledger range"}),"\n",(0,r.jsx)(n.li,{children:"Ongoing operation: Minimal costs for recent ledgers"}),"\n",(0,r.jsx)(n.li,{children:"Historical queries: Costs depend on frequency and data volume"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"authentication-errors",children:"Authentication Errors"}),"\n",(0,r.jsx)(n.p,{children:"If you see authentication errors:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Verify your credentials are properly mounted"}),"\n",(0,r.jsx)(n.li,{children:"Ensure your GCP account has billing enabled"}),"\n",(0,r.jsxs)(n.li,{children:["Check that you're authenticated: ",(0,r.jsx)(n.code,{children:"gcloud auth list"})]}),"\n",(0,r.jsx)(n.li,{children:"Verify the bucket and path are correct"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"performance-issues",children:"Performance Issues"}),"\n",(0,r.jsx)(n.p,{children:"For slow historical queries:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Increase ",(0,r.jsx)(n.code,{children:"DATASTORE_WORKERS"})]}),"\n",(0,r.jsx)(n.li,{children:"Check network connectivity to Google Cloud"}),"\n",(0,r.jsx)(n.li,{children:"Monitor container resource usage"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"storage-issues",children:"Storage Issues"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"HISTORY_RETENTION_WINDOW = 1"})," setting minimizes local storage. If you need more recent ledgers cached locally, increase this value."]}),"\n",(0,r.jsx)(n.h2,{id:"production-considerations",children:"Production Considerations"}),"\n",(0,r.jsx)(n.h3,{id:"security",children:"Security"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Use service account authentication with minimal permissions"}),"\n",(0,r.jsx)(n.li,{children:"Run the container with a non-root user"}),"\n",(0,r.jsx)(n.li,{children:"Implement SSL termination with a reverse proxy"}),"\n",(0,r.jsx)(n.li,{children:"Restrict network access to the RPC endpoint"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"monitoring",children:"Monitoring"}),"\n",(0,r.jsx)(n.p,{children:"Set up monitoring for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Container health and resource usage"}),"\n",(0,r.jsx)(n.li,{children:"RPC endpoint availability"}),"\n",(0,r.jsx)(n.li,{children:"Query performance metrics"}),"\n",(0,r.jsx)(n.li,{children:"Datastore access patterns"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"backup-strategy",children:"Backup Strategy"}),"\n",(0,r.jsx)(n.p,{children:"While the datastore provides historical data, consider:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Regular configuration backups"}),"\n",(0,r.jsx)(n.li,{children:"Database snapshots for quick recovery"}),"\n",(0,r.jsx)(n.li,{children:"Disaster recovery procedures"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"alternative-datastores",children:"Alternative Datastores"}),"\n",(0,r.jsx)(n.p,{children:"Stellar RPC currently supports two datastore types:"}),"\n",(0,r.jsx)(n.h3,{id:"google-cloud-storage-gcs",children:"Google Cloud Storage (GCS)"}),"\n",(0,r.jsx)(n.p,{children:"This guide uses GCS with Obsrvr's public testnet bucket."}),"\n",(0,r.jsx)(n.h3,{id:"aws-s3",children:"AWS S3"}),"\n",(0,r.jsx)(n.p,{children:"For S3-based datastores, use this configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "type": "S3",\n  "params": {\n    "destination_bucket_path": "your-s3-bucket",\n    "region": "us-east-1",\n    "endpoint_url": "endpoint url optional"\n  }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"You'll need to configure AWS credentials similarly to the GCS setup."}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Explore ",(0,r.jsx)(n.a,{href:"https://developers.stellar.org/docs/data/rpc",children:"Stellar RPC API documentation"})]}),"\n",(0,r.jsxs)(n.li,{children:["Learn about ",(0,r.jsx)(n.a,{href:"/docs/intro",children:"Obsrvr's managed RPC services"})]}),"\n",(0,r.jsxs)(n.li,{children:["Set up ",(0,r.jsx)(n.a,{href:"https://prometheus.io/",children:"monitoring and alerting"})," for your node"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"need-help",children:"Need Help?"}),"\n",(0,r.jsxs)(n.p,{children:["If you prefer a managed solution without infrastructure complexity, consider ",(0,r.jsx)(n.a,{href:"/docs/intro",children:"Obsrvr's Gateway Services"})," which provide:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Instant access to full history"}),"\n",(0,r.jsx)(n.li,{children:"No infrastructure management"}),"\n",(0,r.jsx)(n.li,{children:"Enterprise-grade reliability"}),"\n",(0,r.jsx)(n.li,{children:"Simple API integration"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Contact us at ",(0,r.jsx)(n.a,{href:"mailto:support@withobsrvr.com",children:"support@withobsrvr.com"})," for more information."]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var s=t(6540);const r={},l=s.createContext(r);function i(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);